#!/usr/bin/env bash

export WD=$PWD

if [ ! -d "$WD/bin" ]; then
    mkdir "$WD/bin"
fi

runa () {
    handle=$(echo "$1" | sed 's/^[a-z\/]*\/\(.*\)\.[a-z]*$/\1/')
    fasm "$1" "$WD/bin/${handle}" \
        && "$WD/bin/${handle}"
}

runc () {
    handle=$(echo "$1" | sed 's/^[a-z\/]*\/\(.*\)\.[a-z]*$/\1/')
    fasm "$1" "$WD/bin/${handle}".o \
        && ld -fuse-ld=mold -o "$WD/bin/${handle}" -lc "$WD/bin/${handle}".o \
        && "$WD/bin/${handle}"
}

export -f runa
export -f runc
